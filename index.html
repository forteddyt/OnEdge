<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <title>Bing Meteor Game</title>
    <style>
    	* { padding: 0; margin: 0; }
    	canvas { background: #eee; display: block; margin: 0 auto; }
    </style>
</head>
<body>
<canvas id="gameCanvas" width="480" height="320"></canvas>

<script src="player.js"></script>
<script src="meteor.js"></script>
<script src="space.js"></script>
<script src="platform.js"></script>
<script src="game.js"></script>
<script>

var canvas = document.getElementById("gameCanvas");
var ctx = canvas.getContext("2d");
console.log("Starting...")
new Game(ctx)

const Consts = {
	meteorRadius : 10,
	meteorSpeed : 2, //default fall speed for meteors per frame */
	buttonWidth : canvas.width*2/5,
	buttonHeight : canvas.width/8,
	gameOverWidth : canvas.width*3/4,
	gameOverHeight : canvas.height/4,
	meteorSpawnRate : 5,
};


var meteors = []; //array of all meteors on screen
var frameCount = 0; //ticker that increments each frame
var gameOver = false; //true iff game player has lost

//animation
var scoreFlashDuration = 0;
var scoreFlashValue = 0;
const SCORE_FLASH_FRAMES = 240;
const SCORE_FLASH_SPEED = 30;

//Drawing
function drawScoreCounter() {
	var score = Math.floor(frameCount/10);
	ctx.font = "20px Monospace";
	if (score == 100 || score == 500 || score == 1000 || score == 2000 || score == 5000) {
		scoreFlashDuration = SCORE_FLASH_FRAMES;
		scoreFlashValue = score;
	}

	if (scoreFlashDuration > 0) {
		scoreFlashDuration--;
		if (Math.floor(scoreFlashDuration / SCORE_FLASH_SPEED) % 2 == 1) {
			ctx.fillText(scoreFlashValue, 10, 20);
		}
	} else {
		ctx.fillText(score, 10, 20);
	}
}

//Game Controllers

function endGameGUI() {
	var midWidth = canvas.width/2;
	var midHeight = canvas.height/2;

	//rect
	ctx.beginPath();

	ctx.rect(midWidth - buttonWidth/2, 3*midHeight/2 - buttonHeight*2/3, buttonWidth, buttonHeight);
    ctx.fillStyle = "#e0e0e0";
	ctx.fill();
	ctx.strokeStyle =  "#b5b3b3";
	ctx.stroke();

	ctx.rect(midWidth - gameOverWidth/2, midHeight - gameOverHeight*2/3, gameOverWidth, gameOverHeight);
    ctx.fillStyle = "#eee";
	ctx.fill();

	ctx.closePath();

	//text
	ctx.fillStyle = "#0095DD";
	ctx.font = "bold 50px Monospace";
	ctx.textAlign = "center";
	ctx.fillText("GAME OVER", midWidth, midHeight);

	ctx.font = "bold 30px Monospace";
	ctx.fillText("PLAY AGAIN", midWidth, 3*midHeight/2);
}

function draw() {
    ctx.clearRect(0, 0, canvas.width, canvas.height);

    //draw
    drawPlatform();
    drawScoreCounter();

    //update

    player.checkCollisions(meteors);

	if (gameOver) {
		endGameGUI();
		clearInterval(interval);
	}
    
    frameCount++;

}

</script>

